<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="./images/live.png" />
    <title id="pageTitle">Fixtures</title>
    <meta property="og:image" content="https://tchiphuong.github.io/iptv/images/thumbnail.png" />
    <meta property="og:url" content="https://tchiphuong.github.io/iptv" />
    <meta property="og:type" content="article" />
    <meta property="og:image:type" content="image/jpeg" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="./src-new//build/tailwind.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.10/tailwind.min.css" />
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        #videoContainer {
            width: 100%;
            min-height: calc((100vw * 9) / 16);
            z-index: 2;
        }

        .main-content {
            margin-bottom: 0;
        }

        @media (min-width: 1024px) {
            .main-content {
                margin-bottom: 0;
            }

            #videoContainer {
                width: 100%;
                min-height: unset;
            }
        }

        #chat {
            height: calc(100% + 100px);
            transform: translateY(-100px);
            z-index: 1;
        }

        .min-h-14 {
            min-height: 3.5rem;
        }
    </style>
</head>
<body class="flex flex-col">
    <div class="flex gap-1 flex-wrap items-center p-1 shadow min-h-14 px-4 w-full">
        <a href="./" class="flex items-center gap-1">
            <!-- house icon by Free Icons (https://free-icons.github.io/free-icons/) -->
            <svg xmlns="http://www.w3.org/2000/svg" height="1em" fill="currentColor" viewBox="0 0 512 512">
                <path
                    d="M 511.11265164644715 256.4436741767764 Q 510.2253032928943 267.9792027729636 502.23916811091857 275.96533795493934 L 502.23916811091857 275.96533795493934 L 502.23916811091857 275.96533795493934 Q 494.2530329289428 283.95147313691507 482.71750433275565 284.8388214904679 L 454.3223570190641 284.8388214904679 L 454.3223570190641 284.8388214904679 L 455.209705372617 426.81455805892546 L 455.209705372617 426.81455805892546 Q 454.3223570190641 430.3639514731369 454.3223570190641 433.91334488734833 L 454.3223570190641 448.11091854419413 L 454.3223570190641 448.11091854419413 Q 454.3223570190641 463.19584055459273 443.6741767764298 472.95667244367417 Q 433.91334488734833 483.6048526863085 418.82842287694973 483.6048526863085 L 404.630849220104 483.6048526863085 L 404.630849220104 483.6048526863085 Q 402.8561525129983 483.6048526863085 401.9688041594454 483.6048526863085 Q 400.19410745233967 483.6048526863085 398.41941074523396 483.6048526863085 L 369.1369150779896 483.6048526863085 L 347.840554592721 483.6048526863085 Q 332.75563258232233 483.6048526863085 322.9948006932409 472.95667244367417 Q 312.34662045060657 463.19584055459273 312.34662045060657 448.11091854419413 L 312.34662045060657 426.81455805892546 L 312.34662045060657 426.81455805892546 L 312.34662045060657 370.02426343154247 L 312.34662045060657 370.02426343154247 Q 312.34662045060657 357.6013864818024 304.36048526863084 349.6152512998267 Q 296.3743500866551 341.62911611785097 283.95147313691507 341.62911611785097 L 227.16117850953205 341.62911611785097 L 227.16117850953205 341.62911611785097 Q 214.73830155979203 341.62911611785097 206.75216637781628 349.6152512998267 Q 198.76603119584055 357.6013864818024 198.76603119584055 370.02426343154247 L 198.76603119584055 426.81455805892546 L 198.76603119584055 426.81455805892546 L 198.76603119584055 448.11091854419413 L 198.76603119584055 448.11091854419413 Q 198.76603119584055 463.19584055459273 188.11785095320624 472.95667244367417 Q 178.35701906412478 483.6048526863085 163.27209705372616 483.6048526863085 L 141.97573656845753 483.6048526863085 L 113.58058925476602 483.6048526863085 Q 112.69324090121317 483.6048526863085 111.8058925476603 483.6048526863085 Q 110.91854419410745 483.6048526863085 110.03119584055459 483.6048526863085 Q 108.25649913344887 483.6048526863085 106.48180242634315 483.6048526863085 L 92.2842287694974 483.6048526863085 L 92.2842287694974 483.6048526863085 Q 77.19930675909879 483.6048526863085 67.43847487001733 472.95667244367417 Q 56.79029462738301 463.19584055459273 56.79029462738301 448.11091854419413 L 56.79029462738301 348.72790294627384 L 56.79029462738301 348.72790294627384 Q 56.79029462738301 347.840554592721 56.79029462738301 346.06585788561523 L 56.79029462738301 284.8388214904679 L 56.79029462738301 284.8388214904679 L 28.395147313691506 284.8388214904679 L 28.395147313691506 284.8388214904679 Q 15.972270363951473 283.95147313691507 7.986135181975737 275.96533795493934 Q 0 267.9792027729636 0 256.4436741767764 Q 0 244.02079722703638 8.873483535528596 235.1473136915078 L 236.03466204506066 36.38128249566724 L 236.03466204506066 36.38128249566724 Q 245.79549393414212 28.395147313691506 255.55632582322357 29.28249566724437 Q 266.2045060658579 29.28249566724437 274.19064124783364 35.493934142114384 L 501.35181975736566 235.1473136915078 L 501.35181975736566 235.1473136915078 Q 512 244.02079722703638 511.11265164644715 256.4436741767764 L 511.11265164644715 256.4436741767764 Z" />
            </svg>
            <span class="hidden md:block">Trang chủ</span>
        </a>
        <span>/</span>
        <img id="home" class="w-8 h-8 object-cover hidden">
        <span> vs </span>
        <img id="away" class="w-8 h-8 object-cover hidden">
        <span> | </span>
        <div id="commentators" class="flex -space-x-4 rtl:space-x-reverse"></div>
        <ul id="playUrl" class="flex gap-2 flex-wrap items-center flex-grow"></ul>
        <button id="chatButton" class="px-3 py-3 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hidden" title="Bật/tắt chat">
            <!-- house icon by Free Icons (https://free-icons.github.io/free-icons/) -->
            <svg xmlns="http://www.w3.org/2000/svg" height="1em" fill="currentColor" viewBox="0 0 514 448">
                <path d="M 514 208 Q 513 266 479 313 L 479 313 L 479 313 Q 445 360 387 388 L 387 388 L 387 388 Q 330 415 258 416 Q 202 416 154 398 Q 135 412 100 429 Q 62 446 18 448 Q 8 448 3 438 Q 0 428 7 421 Q 7 421 7 421 Q 7 421 7 421 Q 7 421 7 421 Q 7 421 7 421 Q 7 421 7 421 Q 7 421 7 421 Q 7 421 7 421 Q 7 421 7 421 L 7 420 L 7 420 Q 7 420 7 420 Q 7 420 8 419 Q 10 417 13 413 Q 20 406 28 392 Q 45 366 50 329 Q 3 277 2 208 Q 3 150 37 103 Q 71 56 129 28 Q 186 1 258 0 Q 330 1 387 28 Q 445 56 479 103 Q 513 150 514 208 L 514 208 Z" />
            </svg>
        </button>
    </div>
    <div class="flex flex-1 flex-col lg:flex-row overflow-hidden main-content">
        <div id="videoContainer" class="flex-1"></div>
        <div id="chat-wrap" class="h-full hidden">
            <div class="h-full">
                <div class="flex border-b">
                    <button id="tab1Button" class="tab-button w-full py-2 text-center bg-black text-blue-700 font-semibold border-blue-700 focus:outline-none">
                        Chung
                    </button>
                    <button id="tab2Button" class="tab-button w-full py-2 text-center bg-black text-gray-100 hover:text-blue-700 focus:outline-none">
                        Trận đấu
                    </button>
                </div>

                <div class="h-full">
                    <div id="tab1Content" class="tab-content h-full">
                        <div class="h-full" style="height: calc(100% + 20px);">
                            <iframe id="videoFrame" src="https://www6.cbox.ws/box/?boxid=827198&boxtag=wskql9" width="100%" height="100%" allowfullscreen="true" autoplay="1" sandbox="">
                            </iframe>
                        </div>
                    </div>
                    <div id="tab2Content" class="tab-content h-full hidden overflow-hidden">
                        <div id="chat" class=""></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed inset-0 z-30 flex items-center justify-center h-screen bg-white cursor-pointer flex-col gap-2" id="spin" style="display: none">
        <div class="loader"></div>
    </div>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="js/ajax.js" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            $('#chatButton').click(function () {
                $('#chat-wrap').toggleClass('hidden');
            });

            $(document).ready(function () {
                $('#tab1Button').click(function () {
                    $('#tab1Content').removeClass('hidden').addClass('block');
                    $('#tab2Content').removeClass('block').addClass('hidden');
                    $(this).addClass('text-blue-700 font-semibold').removeClass('text-gray-100');
                    $('#tab2Button').removeClass('text-blue-700 font-semibold').addClass('text-gray-100');
                });

                $('#tab2Button').click(function () {
                    $('#tab2Content').removeClass('hidden').addClass('block');
                    $('#tab1Content').removeClass('block').addClass('hidden');
                    $(this).addClass('text-blue-700 font-semibold').removeClass('text-gray-100');
                    $('#tab1Button').removeClass('text-blue-700 font-semibold').addClass('text-gray-100');
                });
            });
        });
        document.addEventListener("DOMContentLoaded", function () {
            var urlParser = new URL(window.location.href);
            if (urlParser.searchParams.get("id")) {
                const id = urlParser.searchParams.get("id")
                const isLive = urlParser.searchParams.get("isLive")
                if (isLive == 1) {
                    $.ajax({
                        url: `https://api.vebo.xyz/api/match/${id}/meta`
                    })
                        .done(function (response) {
                            console.log(response)
                            const playUrl = response.data.play_urls
                            if (playUrl && playUrl.length > 1) {
                                let lstQuality = ["nhà đài"];
                                playUrl.forEach(element => {
                                    if (!lstQuality.includes(element.name.toLowerCase())) {
                                        if (element.name === "FullHD") {
                                            $("#playUrl").append(`<li><a class="flex items-center justify-center px-3 py-2 text-sm font-medium text-center text-white bg-blue-700 rounded-lg" data-type="url" href="${element.url}" title="${element.name}">${element.name}</a></li>`)
                                        } else {
                                            $("#playUrl").append(`<li><a class="hover:text-blue-600 hover:font-bold" data-type="url" href="${element.url}" title="${element.name}">${element.name}</a></li>`)
                                        }
                                    }
                                });
                                response.data.commentators.forEach(element => {
                                    $("#commentators").append(`<img class="w-10 h-10 border-2 border-white rounded-full shadow dark:border-gray-800" src="${element.avatar}" alt="${element.name}" title="${element.name}">`)
                                });
                                var fullHD = playUrl.find(x => x.name === "FullHD")?.url
                                if (fullHD) {
                                    setPlayer(fullHD);
                                } else {
                                    setPlayer(playUrl[0]?.url);
                                }
                            } else {
                                swal("Oops", "Trận đấu chưa bắt đầu!", "error")
                                    .then(() => {
                                        window.close();
                                    });
                            }

                            $("a[data-type='url']").on("click", function (event) {
                                event.preventDefault();
                                const _this = $(this);
                                setPlayer(_this.attr('href'))
                                $("a[data-type='url']").removeClass("flex items-center justify-center px-3 py-2 text-sm font-medium text-center text-white bg-blue-700 rounded-lg").addClass("hover:text-blue-600 hover:font-bold");
                                _this.addClass("flex items-center justify-center px-3 py-2 text-sm font-medium text-center text-white bg-blue-700 rounded-lg").removeClass("hover:text-blue-600 hover:font-bold");
                            });
                        })
                        .fail(function () {
                            CloseLoading();
                        })
                        .always(function () {
                            CloseLoading();
                        });

                    $.ajax({
                        url: `https://api.vebo.xyz/api/match/${id}`,
                    })
                        .done(function (response) {
                            if (response.data.match_status === "finished") {
                                swal("Oops", "Trận đấu đã kết thúc!", "error")
                                    .then(() => {
                                        window.close();
                                    });
                            }
                            console.log(response)
                            var iframe = `<iframe id="videoFrame" 
                                src="https://chat.vebotv.me/?token=&room=${response.data.room_id}" 
                                width="100%" 
                                height="100%"
                                allowfullscreen="true" 
                                autoplay="1" 
                                sandbox="allow-scripts">
                                </iframe>`;
                            // Using jQuery to empty the container and append the new iframe
                            $("#chat-wrap").removeClass("hidden");
                            $("#chatButton").removeClass("hidden");
                            $("#chat").empty().append(iframe);

                            const name = "Trực tiếp " + response.data.name + " (" + response.data.commentators.map(x => x.name).join(", ") + ")";
                            document.title = name;
                            // $("#title").text(`${response.data.name}`);
                            $("#home").attr("src", response.data.home.logo).attr("alt", response.data.home.name).attr("title", response.data.home.name).removeClass("hidden");
                            $("#away").attr("src", response.data.away.logo).attr("alt", response.data.away.name).attr("title", response.data.away.name).removeClass("hidden");
                        })
                        .fail(function () {
                            CloseLoading();
                        })
                        .always(function () {
                            CloseLoading();
                        });
                }
                else {
                    $.ajax({
                        url: `https://api.vebo.xyz/api/news/xoilac/detail/${id}`,
                    })
                        .done(function (response) {
                            console.log(response)
                            const playUrl = response?.data?.video_url
                            setPlayer(playUrl)
                            $('[property="og:image"]').attr("content", response.data.feature_image)
                            const name = response.data.name
                            document.title = name;
                        })
                        .fail(function () {
                            CloseLoading();
                        })
                        .always(function () {
                            CloseLoading();
                        });
                }
            }
        });

        function setPlayer(url) {
            if (url) {
                var iframe = `<iframe 
                src="https://m10.ldplayer.xyz/v11/?link=${url}&t=tr&theme_id=tc&is_live=0" 
                width="100%" 
                height="100%" 
                allowfullscreen="" 
                allowtransparency="yes" 
                allow="autoplay" 
                frameborder="0" 
                marginheight="0" 
                marginwidth="0" 
                scrolling="auto" 
                </iframe>`;
                // Using jQuery to empty the container and append the new iframe
                $("#videoContainer").empty().append(iframe);
            }
            CloseLoading()
        }
    </script>
</body>
</html>